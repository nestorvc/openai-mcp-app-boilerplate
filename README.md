# OpenAI MCP App Boilerplate

A clean, minimal boilerplate for building ChatGPT Apps using the Model Context Protocol (MCP).

## Overview

This boilerplate provides:
- A React component bundle system with Vite
- A Node.js MCP server using the official TypeScript SDK
- **Full `window.openai` API integration** for two-way communication with ChatGPT
- Simple, clean project structure

## window.openai API Integration

This boilerplate demonstrates how to use the ChatGPT App SDK's `window.openai` API for building interactive widgets. The `window.openai` API enables your React components to:

### Key Features

- **Read data from MCP server**: Access `toolOutput` and `toolInput` from your MCP server
- **Persist widget state**: Save state that's visible to ChatGPT using `setWidgetState`
- **Call server tools**: Trigger server actions from your component using `callTool`
- **Send follow-up messages**: Insert messages into the ChatGPT conversation
- **Request layout changes**: Switch between inline, PiP, and fullscreen modes
- **Access theme/layout info**: Get ChatGPT's theme, device type, and layout constraints

### Usage Examples

```tsx
import { 
  useToolOutput, 
  useWidgetState, 
  useCallTool, 
  useSendFollowUpMessage 
} from './hooks/useOpenAI';

function MyComponent() {
  // Get data from MCP server
  const toolOutput = useToolOutput();
  const todos = toolOutput?.todos || [];
  
  // Persist state visible to ChatGPT
  const [favorites, setFavorites] = useWidgetState({ items: [] });
  
  // Call server tools
  const { callTool, isLoading } = useCallTool();
  const refreshData = () => callTool('refresh-todos', { userId: '123' });
  
  // Send messages to ChatGPT
  const sendMessage = useSendFollowUpMessage();
  const notifyCompletion = () => sendMessage('All tasks completed!');
  
  return (
    <div>
      {todos.map(todo => <div key={todo.id}>{todo.title}</div>)}
      <button onClick={refreshData} disabled={isLoading}>
        Refresh
      </button>
    </div>
  );
}
```

### Available Hooks

- `useToolOutput()` - Read data from MCP server tool response
- `useToolInput()` - Read parameters passed to your MCP tool
- `useWidgetState(initialState)` - Persist state visible to ChatGPT
- `useCallTool()` - Call MCP server tools from component
- `useSendFollowUpMessage()` - Send messages to ChatGPT conversation
- `useRequestDisplayMode()` - Request layout changes (inline/pip/fullscreen)
- `useOpenAIGlobals()` - Access theme, device, and layout information

### Server Tools

The MCP server includes several tools that demonstrate component-to-server communication:

- **`show-todo`** - Main tool that displays the todo widget with sample data
- **`refresh-todos`** - Called by the component to refresh data from the server
- **`save-todo-state`** - Called by the component to persist changes back to the server

These tools show how to:
- Pass data to components via `structuredContent`
- Handle tool calls initiated by components
- Implement two-way data flow between ChatGPT and your widget

## Project Structure

```
app/
├── web/                  # Component bundle source
│   ├── src/
│   │   ├── components/   # React widget components
│   │   └── index.css     # Global Tailwind styles
│   ├── dist/             # Build output
│   ├── package.json
│   └── tsconfig.json
│
└── server/               # MCP server (Node.js)
    ├── src/
    │   └── server.ts     # Main server file with MCP handlers
    ├── package.json
    └── tsconfig.json
```

### Folders

#### `web/` - React Component Bundle System
- **`src/components/`** - React widget components (todo example)
- **`src/hooks/`** - Custom React hooks for `window.openai` API integration
- **`src/index.css`** - Global Tailwind CSS styles
- **`dist/`** - Build output (HTML/JS/CSS files generated by build script)
- **`package.json`** - Web dependencies (React, Vite, Tailwind, etc.)
- **`tsconfig.json`** - TypeScript config for React components (JSX, DOM types)
- **`vite.config.ts`** - Vite dev server configuration
- **`build.mts`** - Build script that bundles components into standalone assets

#### `server/` - MCP (Model Context Protocol) Server
- **`src/server.ts`** - Main server file that handles MCP protocol requests from ChatGPT
- **`package.json`** - Server dependencies (MCP SDK, Zod)
- **`tsconfig.json`** - TypeScript config for Node.js server code

### Root Files

- **`package.json`** - Convenience scripts only (no dependencies - each subdirectory manages its own)
- **`README.md`** - This file!

## How It Works

1. **Build Process**: `web/build.mts` finds all components in `src/components/`, bundles them with Vite, and outputs standalone HTML/CSS/JS files to `dist/`.

2. **Server**: `server/src/server.ts` serves the built HTML files to ChatGPT via the MCP protocol when tools are called.

3. **Development**: Run `pnpm run dev` for hot reload of components, or `pnpm run build` to bundle for production.

## Prerequisites

- Node.js 18+
- pnpm (recommended)

## Getting Started

### Install dependencies

```bash
pnpm install           # Root dependencies
cd web && pnpm install # Web component dependencies
cd ../server && pnpm install # Server dependencies
```

Or use the convenience script:
```bash
pnpm run install:all
```

### Build the widget components

```bash
pnpm run build
```

This generates `.html`, `.js`, and `.css` files in `web/dist/` for each component.

### Start the MCP server

```bash
pnpm run server
```

The server will start on `http://localhost:8000` with the MCP endpoint at `http://localhost:8000/mcp`.

## Development

### UI Debugging (Local Development)

For local development with hot reload and debugging:

```bash
# Start the Vite dev server for UI debugging
pnpm run dev
```

This will:
- Start Vite dev server on `http://localhost:5173`
- Enable hot reload for instant updates
- Provide source maps for debugging
- Serve your React components directly

**Important Notes:**
- This is ONLY for local debugging - ChatGPT never sees this
- The dev server uses `web/src/index.tsx` as entry point
- Production uses `web/src/components/*/index.jsx` files instead

### Full Development Setup

For complete development with both UI debugging and MCP server:

```bash
# Terminal 1: Web component dev server (UI debugging)
pnpm run dev

# Terminal 2: MCP server (for ChatGPT testing)
pnpm run server
```

### Development vs Production

| Environment | Entry Point | Purpose | URL |
|-------------|-------------|---------|-----|
| **Development** | `src/index.tsx` | UI debugging with hot reload | `localhost:5173` |
| **Production** | `src/components/*/index.jsx` | ChatGPT integration | `localhost:8000` |

**To test with ChatGPT:**
1. Build production assets: `pnpm run build`
2. Start MCP server: `pnpm run server`
3. Use tunnel (ngrok) to expose `localhost:8000`

## Creating New Widgets

1. Create a new component directory in `web/src/components/` with an `index.jsx` file
2. The build script will automatically pick it up when you run `pnpm run build`
3. Register the widget in `server/src/server.ts` in the `widgets` array
4. Rebuild with `pnpm run build`

### Component Structure

Each component should have:
- `index.jsx` - Entry point that exports the component
- Component files (e.g., `MyWidget.jsx`, `my-widget.css`)
- Any data files (e.g., `data.json`)

Example:
```
web/src/components/my-widget/
├── index.jsx
├── MyWidget.jsx
└── my-widget.css
```

## Testing in ChatGPT

To test your app in ChatGPT:

1. **Build production assets first:**
   ```bash
   pnpm run build
   ```
   This creates the bundled files in `web/dist/` that ChatGPT will use.

2. **Start the MCP server:**
   ```bash
   pnpm run server
   ```

3. **Enable [developer mode](https://platform.openai.com/docs/guides/developer-mode)**

4. **Add your app in Settings > Connectors**

5. **Create a tunnel to expose your local server:**
   ```bash
   # Using ngrok
   ngrok http 8000
   
   # Or using Cloudflare Tunnel
   cloudflared tunnel --url http://localhost:8000
   ```

6. **Add the tunnel URL to ChatGPT** (don't forget to add "/mcp"):
   ```
   https://your-subdomain.ngrok-free.app/mcp
   ```

**Important:** Always run `pnpm run build` after making changes to your components before testing with ChatGPT!

## Deployment

Set the `BASE_URL` environment variable when building:

```bash
BASE_URL=https://your-domain.com pnpm run build
```


## License

MIT
